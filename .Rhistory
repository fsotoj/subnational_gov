inherit = F
)
}
plot
df
df <- read.xlsx("data/complete_database_edit2.xlsx") %>%
filter(country_name == "ARGENTINA", state_name == "MENDOZA")
df
df %>% View()
df <- read.xlsx("data/complete_database_edit2.xlsx") %>%
filter(country_name == "ARGENTINA", state_name == "CAPITAL FEDERAL") %>%
filter(electoral_sub_year == 1) %>%
select(year,registered = voters_registered_sub, voters = total_voters_sub, valid_votes = valid_votes_sub,
invalid_votes = invalid_votes_sub, votes_winner = votes_candidate_winner, votes_second = second_place_votes,
votes_last = last_place_votes, ideology = ideo_party_sub,
party = head_party_sub, name = head_name_sub, year)
df %>% names()
group_labels <- c("Left", "Center Left", "Center Right", "Right")
names(group_labels) <- c(1, 2, 3, 4)
# Map group numbers to labels
df$ideology <- factor(df$ideology, levels = 1:4, labels = group_labels)
# Sort by year
df <- df %>% arrange(year)
# Define color palette manually
ideology_colors <- c(
"Left" = "#d73027",
"Center Left" = "#fc8d59",
"Center Right" = "#91bfdb",
"Right" = "#4575b4"
)
# Extend hover text for winner
df$popup_winner <- paste0(
"<b>", df$name, "</b><br>",
"Party: ", df$party, "<br>",
"Winner Votes: ", df$votes_winner, "<br>",
"Registered: ", df$registered
)
# Create second and last place hover text
df$popup_second <- paste0("Second Place Votes: ", df$votes_second)
df$popup_last <- paste0("Last Place Votes: ", df$votes_last)
# Start with winner bubble plot
plot <- plot_ly(
data = df,
x = ~year,
y = ~votes_winner,
type = 'scatter',
mode = 'markers',
color = ~ideology,
colors = ideology_colors,
text = ~popup_winner,
hoverinfo = "text",
marker = list(size = 30, opacity = 0.9)
) %>%
# Add second place votes as small triangles
add_trace(
data = df,
x = ~year,
y = ~votes_second,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'triangle-up', size = 10, color = 'black'),
text = ~popup_second,
hoverinfo = "text",
name = "Second Place", inherit = F
) %>%
# Add last place votes as small squares
add_trace(
data = df,
x = ~year,
y = ~votes_last,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'square', size = 10, color = 'gray'),
text = ~popup_last,
hoverinfo = "text",
name = "Last Place",
inherit = F
) %>%
layout(
title = "Votes for Winner, Second and Last Place Over Time",
xaxis = list(title = "Year"),
yaxis = list(title = "Votes"),
legend = list(orientation = "h", y = -0.2)
)
plot <- plot %>%
add_trace(
data = df,
x = ~year,
y = ~registered,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'x', size = 20, color = "black"),
name = 'Registered Voters',
hoverinfo = "text",
text = ~paste("Registered Voters:", registered),
inherit = F
)
for (i in 1:nrow(df)) {
plot <- plot %>%
add_segments(
x = df$year[i],
xend = df$year[i],
y = df$votes_winner[i],
yend = df$registered[i],
line = list(color = 'gray', width = 1),
showlegend = FALSE,
hoverinfo = "none",
inherit = F
)
}
plot
df <- read.xlsx("data/complete_database_edit2.xlsx") %>%
filter(country_name == "ARGENTINA", state_name == "CAPITAL FEDERAL") %>%
filter(electoral_sub_year == 1) %>%
rename(registered = voters_registered_sub, voters = total_voters_sub, valid_votes = valid_votes_sub,
invalid_votes = invalid_votes_sub, votes_winner = votes_candidate_winner, votes_second = second_place_votes,
votes_last = last_place_votes, ideology = ideo_party_sub,
party = head_party_sub, name = head_name_sub)
df
# Extend hover text for winner
df$popup_winner <- paste0(
"<b>", df$name, "</b><br>",
"Party: ", df$party, "<br>",
"Winner Votes: ", df$votes_winner, "<br>",
"Winner margin: ", df$margin_victory_exe
)
df$popup_registered <- paste0(
"Registered voters", df$registered, "</b><br>",
"Valid votes ratio: ", df$valid_votes_ratio_sub, "<br>",
"Invalid votes ratio: ", df$invalid_votes_ratio_sub, "<br>"
)
library(plotly)
library(dplyr)
df <- read.xlsx("data/complete_database_edit2.xlsx") %>%
filter(country_name == "ARGENTINA", state_name == "CAPITAL FEDERAL") %>%
filter(electoral_sub_year == 1) %>%
rename(registered = voters_registered_sub, voters = total_voters_sub, valid_votes = valid_votes_sub,
invalid_votes = invalid_votes_sub, votes_winner = votes_candidate_winner, votes_second = second_place_votes,
votes_last = last_place_votes, ideology = ideo_party_sub,
party = head_party_sub, name = head_name_sub)
df %>% names()
group_labels <- c("Left", "Center Left", "Center Right", "Right")
names(group_labels) <- c(1, 2, 3, 4)
# Map group numbers to labels
df$ideology <- factor(df$ideology, levels = 1:4, labels = group_labels)
# Sort by year
df <- df %>% arrange(year)
# Define color palette manually
ideology_colors <- c(
"Left" = "#d73027",
"Center Left" = "#fc8d59",
"Center Right" = "#91bfdb",
"Right" = "#4575b4"
)
# Extend hover text for winner
df$popup_winner <- paste0(
"<b>", df$name, "</b><br>",
"Party: ", df$party, "<br>",
"Winner Votes: ", df$votes_winner, "<br>",
"Winner margin: ", df$margin_victory_exe
)
df$popup_registered <- paste0(
"Registered voters", df$registered, "</b><br>",
"Valid votes ratio: ", df$valid_votes_ratio_sub, "<br>",
"Invalid votes ratio: ", df$invalid_votes_ratio_sub, "<br>"
)
# Create second and last place hover text
df$popup_second <- paste0("Second Place Votes: ", df$votes_second)
df$popup_last <- paste0("Last Place Votes: ", df$votes_last)
# Start with winner bubble plot
plot <- plot_ly(
data = df,
x = ~year,
y = ~votes_winner,
type = 'scatter',
mode = 'markers',
color = ~ideology,
colors = ideology_colors,
text = ~popup_winner,
hoverinfo = "text",
marker = list(size = 30, opacity = 0.9)
) %>%
# Add second place votes as small triangles
add_trace(
data = df,
x = ~year,
y = ~votes_second,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'triangle-up', size = 10, color = 'black'),
text = ~popup_second,
hoverinfo = "text",
name = "Second Place", inherit = F
) %>%
# Add last place votes as small squares
add_trace(
data = df,
x = ~year,
y = ~votes_last,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'square', size = 10, color = 'gray'),
text = ~popup_last,
hoverinfo = "text",
name = "Last Place",
inherit = F
) %>%
layout(
title = "Votes for Winner, Second and Last Place Over Time",
xaxis = list(title = "Year"),
yaxis = list(title = "Votes"),
legend = list(orientation = "h", y = -0.2)
)
plot <- plot %>%
add_trace(
data = df,
x = ~year,
y = ~registered,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'x', size = 20, color = "black"),
name = 'Registered Voters',
hoverinfo = "text",
text = ~popup_registered,
inherit = F
)
for (i in 1:nrow(df)) {
plot <- plot %>%
add_segments(
x = df$year[i],
xend = df$year[i],
y = df$votes_winner[i],
yend = df$registered[i],
line = list(color = 'gray', width = 1),
showlegend = FALSE,
hoverinfo = "none",
inherit = F
)
}
plot
df <- read.xlsx("data/complete_database_edit2.xlsx") %>%
filter(country_name == "ARGENTINA", state_name == "CAPITAL FEDERAL") %>%
filter(electoral_sub_year == 1)
df %>% names()
group_labels <- c("Left", "Center Left", "Center Right", "Right")
names(group_labels) <- c(1, 2, 3, 4)
group_labels <- c("Left", "Center Left", "Center Right", "Right")
names(group_labels) <- c(1, 2, 3, 4)
# Map group numbers to labels
df$ideo_party_sub <- factor(df$ideo_party_sub, levels = 1:4, labels = group_labels)
# Sort by year
df <- df %>% arrange(year)
# Define color palette manually
ideology_colors <- c(
"Left" = "#d73027",
"Center Left" = "#fc8d59",
"Center Right" = "#91bfdb",
"Right" = "#4575b4"
)
# Extend hover text for winner
df$popup_winner <- paste0(
"<b>", df$head_name_sub, "</b><br>",
"Party: ", df$head_party_sub, "<br>",
"Winner Votes: ", df$votes_candidate_winner, "<br>",
"Winner margin: ", df$margin_victory_exe
)
df$popup_registered <- paste0(
"Registered voters: ", df$voters_registered_sub, "</b><br>",
"Valid votes ratio: ", df$valid_votes_ratio_sub, "<br>",
"Invalid votes ratio: ", df$invalid_votes_ratio_sub, "<br>"
)
# Create second and last place hover text
df$popup_second <- paste0("Second Place Votes: ", df$second_place_votes)
df$popup_last <- paste0("Last Place Votes: ", df$last_place_votes)
library(plotly)
library(dplyr)
df <- read.xlsx("data/complete_database_edit2.xlsx") %>%
filter(country_name == "ARGENTINA", state_name == "CAPITAL FEDERAL") %>%
filter(electoral_sub_year == 1)
group_labels <- c("Left", "Center Left", "Center Right", "Right")
names(group_labels) <- c(1, 2, 3, 4)
# Map group numbers to labels
df$ideo_party_sub <- factor(df$ideo_party_sub, levels = 1:4, labels = group_labels)
# Sort by year
df <- df %>% arrange(year)
# Define color palette manually
ideology_colors <- c(
"Left" = "#d73027",
"Center Left" = "#fc8d59",
"Center Right" = "#91bfdb",
"Right" = "#4575b4"
)
# Extend hover text for winner
df$popup_winner <- paste0(
"<b>", df$head_name_sub, "</b><br>",
"Party: ", df$head_party_sub, "<br>",
"Winner Votes: ", df$votes_candidate_winner, "<br>",
"Winner margin: ", df$margin_victory_exe
)
df$popup_registered <- paste0(
"Registered voters: ", df$voters_registered_sub, "</b><br>",
"Valid votes ratio: ", df$valid_votes_ratio_sub, "<br>",
"Invalid votes ratio: ", df$invalid_votes_ratio_sub, "<br>"
)
# Create second and last place hover text
df$popup_second <- paste0("Second Place Votes: ", df$second_place_votes)
df$popup_last <- paste0("Last Place Votes: ", df$last_place_votes)
# Start with winner bubble plot
plot <- plot_ly(
data = df,
x = ~year,
y = ~votes_candidate_winner,
type = 'scatter',
mode = 'markers',
color = ~ideo_party_sub,
colors = ideology_colors,
text = ~popup_winner,
hoverinfo = "text",
marker = list(size = 30, opacity = 0.9)
) %>%
# Add second place votes as small triangles
add_trace(
data = df,
x = ~year,
y = ~second_place_votes,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'triangle-up', size = 10, color = 'black'),
text = ~popup_second,
hoverinfo = "text",
name = "Second Place", inherit = F
) %>%
# Add last place votes as small squares
add_trace(
data = df,
x = ~year,
y = ~last_place_votes,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'square', size = 10, color = 'gray'),
text = ~popup_last,
hoverinfo = "text",
name = "Last Place",
inherit = F
) %>%
layout(
title = "Votes for Winner, Second and Last Place Over Time",
xaxis = list(title = "Year"),
yaxis = list(title = "Votes"),
legend = list(orientation = "h", y = -0.2)
)
plot <- plot %>%
add_trace(
data = df,
x = ~year,
y = ~voters_registered_sub,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'x', size = 20, color = "black"),
name = 'Registered Voters',
hoverinfo = "text",
text = ~popup_registered,
inherit = F
)
for (i in 1:nrow(df)) {
plot <- plot %>%
add_segments(
x = df$year[i],
xend = df$year[i],
y = df$votes_candidate_winner[i],
yend = df$voters_registered_sub[i],
line = list(color = 'gray', width = 1),
showlegend = FALSE,
hoverinfo = "none",
inherit = F
)
}
plot
df <- read.xlsx("data/complete_database_edit2.xlsx") %>%
filter(country_name == "ARGENTINA", state_name == "CATAMARCA") %>%
filter(electoral_sub_year == 1)
group_labels <- c("Left", "Center Left", "Center Right", "Right")
names(group_labels) <- c(1, 2, 3, 4)
# Map group numbers to labels
df$ideo_party_sub <- factor(df$ideo_party_sub, levels = 1:4, labels = group_labels)
# Sort by year
df <- df %>% arrange(year)
# Define color palette manually
ideology_colors <- c(
"Left" = "#d73027",
"Center Left" = "#fc8d59",
"Center Right" = "#91bfdb",
"Right" = "#4575b4"
)
# Extend hover text for winner
df$popup_winner <- paste0(
"<b>", df$head_name_sub, "</b><br>",
"Party: ", df$head_party_sub, "<br>",
"Winner Votes: ", df$votes_candidate_winner, "<br>",
"Winner margin: ", df$margin_victory_exe
)
df$popup_registered <- paste0(
"Registered voters: ", df$voters_registered_sub, "</b><br>",
"Valid votes ratio: ", df$valid_votes_ratio_sub, "<br>",
"Invalid votes ratio: ", df$invalid_votes_ratio_sub, "<br>"
)
# Create second and last place hover text
df$popup_second <- paste0("Second Place Votes: ", df$second_place_votes)
df$popup_last <- paste0("Last Place Votes: ", df$last_place_votes)
# Start with winner bubble plot
plot <- plot_ly(
data = df,
x = ~year,
y = ~votes_candidate_winner,
type = 'scatter',
mode = 'markers',
color = ~ideo_party_sub,
colors = ideology_colors,
text = ~popup_winner,
hoverinfo = "text",
marker = list(size = 30, opacity = 0.9)
) %>%
# Add second place votes as small triangles
add_trace(
data = df,
x = ~year,
y = ~second_place_votes,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'triangle-up', size = 10, color = 'black'),
text = ~popup_second,
hoverinfo = "text",
name = "Second Place", inherit = F
) %>%
# Add last place votes as small squares
add_trace(
data = df,
x = ~year,
y = ~last_place_votes,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'square', size = 10, color = 'gray'),
text = ~popup_last,
hoverinfo = "text",
name = "Last Place",
inherit = F
) %>%
layout(
title = "Votes for Winner, Second and Last Place Over Time",
xaxis = list(title = "Year"),
yaxis = list(title = "Votes"),
legend = list(orientation = "h", y = -0.2)
)
plot <- plot %>%
add_trace(
data = df,
x = ~year,
y = ~voters_registered_sub,
type = 'scatter',
mode = 'markers',
marker = list(symbol = 'x', size = 20, color = "black"),
name = 'Registered Voters',
hoverinfo = "text",
text = ~popup_registered,
inherit = F
)
for (i in 1:nrow(df)) {
plot <- plot %>%
add_segments(
x = df$year[i],
xend = df$year[i],
y = df$votes_candidate_winner[i],
yend = df$voters_registered_sub[i],
line = list(color = 'gray', width = 1),
showlegend = FALSE,
hoverinfo = "none",
inherit = F
)
}
plot
runApp()
runApp()
runApp()
sort(data$la_state_name)
runApp()
runApp()
runApp()
df <- read.xlsx("data/complete_database_edit2.xlsx") %>%
filter(country_name == "BRAZIL", state_name == "ACRE") %>%
filter(electoral_sub_year == 1)
df
votes_na <- df %>% filter(is.na(voters_registered_sub))
votes_na
votes_na <- df %>% filter(is.na(voters_registered_sub)) %>%
pull(year)
votes_na
runApp()
df <- read.xlsx("data/complete_database_edit2.xlsx") %>%
filter(country_name == "ARGENTINA", state_name == "BUENOS AIRES") %>%
filter(electoral_sub_year == 1)
votes_na <- df %>% filter(is.na(voters_registered_sub)) %>%
pull(year)
votes_na
is.null(votes_na)
length(votes_na)
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
runApp()
